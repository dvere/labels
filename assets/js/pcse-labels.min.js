var t=`^FX ${(new Date).toISOString()}\n^XA^DFR:DELIVERY.GRF\n^FO5,5^GB780,1200,4^FS\n^FO5,240^GB780,860,3^FS\n^FO5,420^GB480,180,3^FS\n^FO482,240^GB302,360,3^FS\n^FO5,660^GB780,1,3^FS\n^FO5,820^GB780,1,3^FS\n^FO5,970^GB780,1,3^FS\n^FO215,60^BY2^BCN,150,N^FN0^FS\n^FO5,25^A0N,30^FB780,1,0,C^FN0^FS\n^FO15,275^A0N,140^FB480,1,0,C^FN1^FS\n^FO15,455^A0N,140^FB480,1,0,C^FN2^FS\n^FO500,365^A0N,140^FB280,1,0,C^FN3^FS\n^FO5,615^A0N,40^FB780,1,0,C^FN4^FS\n^FO15,700^A0N,100^FB780,1,0,C^FN6^FS\n^FO150,840^A0N,24^FN4^FS\n^FO150,870^A0N,24^FN5^FS\n^FO150,900^A0N,24^FN6^FS\n^FO15,1000^A0N,100^FB780,1,0,C^FN8^FS\n^FO170,1120^BY2^BCN,55,Y^FN7^FS\n^XZ`,e={BASINGSTOKE:"BS",BECKTON:"CV",BIRMINGHAM:"BP",BRISTOL:"BL",CAMBRIDGE:"CB",GATWICK:"CW",LEEDS:"LD",LETCHWORTH:"LE",MANCHESTER:"MA",MEDWAY:"ME",MILTON:"MK",NEWCASTLE:"NE",NORWICH:"NR",NOTTINGHAM:"NG",PLYMOUTH:"PL",READING:"NB",SLOUGH:"3S",SOUTHAMPTON:"SO",SWINDON:"SW",TELFORD:"TF",WARWICK:"MC"},n=localStorage.getItem("data-file-type")||"raw",i=document.location.pathname.split("/")[3],a=document.getElementById("order-status").value,s="\n\n^XA^XFR:DELIVERY.GRF\n",r="^XZ",o=["Complete","ReadyForDespatch","Despatched"];function d(){this.detail=new F,this.status=a,this.itemsArray=[this.detail["Delivery Route And Stop"].substr(0,4),this.detail["Location Code"],this.detail.svcCode,this.detail.address_1,this.detail.address,this.detail.postcode,this.detail.id]}function F(){var t=$("nav.account-links").find("li").eq(1).text().trim(),n=this;$("div.col-md-5").each(function(t,e){n[e.innerText]=e.nextElementSibling.innerText}),this.id=$("h3").eq(0).text().trim().split(" ")[2],this.svcCode=e[t.substr(0,t.indexOf(" ")).toUpperCase()],this.address=this["Shipping Address"].split(","),this.address_1=this.address.shift(),this.postcode=this.address.pop()}function c(t){var e={tab:t.status},n=t.detail["Expected Delivery Date"];"TBA"!==n&&(n=n.split("/").reverse().join("-"),e.DateRangeStart=e.DateRangeEnd=n,e.SearchOn=5);let i="/portal/Logistics/Orders?"+$.param(e),a=new Request(i,{credentials:"include",method:"GET"});fetch(a).then(t=>t.text()).then(e=>$(e).find("tr:contains("+t.detail.id+")")).then(t=>$(t).find("td").eq(9).html().split("<br>").sort().reverse()[0]).then(e=>{t.itemsArray.unshift(e),function(t){"application/pdf"===t.format?function(t){let e=new FormData;e.append("file",t.data),fetch("https://lab1.dvere.org/l/",{method:"POST",headers:{Accept:"application/pdf"},mode:"cors",body:e,credentials:"omit"}).then(t=>t.blob()).then(e=>{t.data=e,p(t)})}(t):t.filename?p(t):function(t){let e=window.open();e.document.open(t.format),e.document.write(t.data),e.document.close(),e.focus(),e.print(),e.close()}(t)}(new l(t.itemsArray))})}function l(e){let i=e.pop(),a=e.map(function(t,e){return"^FN"+e+"^FD"+t+"^FS"}).join("\n"),o="";for(var d=i;d>0;d--){o+=s+a+"\n^FN8^FDPieces: "+d+" of "+i+"^FS\n"+r}switch(this.data=t+o,n){case"txt":this.filename=h(e),this.format="text/plain";break;case"pdf":this.filename=h(e),this.format="application/pdf";break;case"raw":this.format="text/plain",this.data="<pre>\n"+this.data+"\n</pre>\n"}}function h(t){return t[1]+"_"+t[7]}function p(t){let e=document.createElement("a"),n=new Blob([t.data],{type:t.format}),i=window.URL.createObjectURL(n);e.style="display: none",e.href=i,e.download=t.filename,e.click(),window.URL.revokeObjectURL(i)}$.when($.ready).then(function(){if(function(t,e){return o.includes(t)&&"Order"===e}(a,i)){var t=prompt("Enter number of packages:",1);if(function(t){return!(0===(t=parseInt(t))||null==t||isNaN(t))}(t)){var e=new d(a);e.itemsArray.push(t),c(e)}}});